name: Build and Release

on:
  release:
    types: [created]

jobs:
  # ------------------------------------------------------------------
  # JOB 1: –°–±–æ—Ä–∫–∞ –¥–ª—è Windows ( fyne-cross )
  # ------------------------------------------------------------------
  build_windows:
    name: üî® Build Windows (x64)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - name: Install fyne-cross
        run: |
          go install github.com/fyne-io/fyne-cross@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH
      - name: Build Windows Binary
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—É—é —Ñ–æ—Ä–º—É —Ñ–ª–∞–≥–æ–≤ –∏ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø–∞–∫–µ—Ç './cmd' —Å—Ç–æ–∏—Ç –≤ –∫–æ–Ω—Ü–µ
        run: |
          $HOME/go/bin/fyne-cross windows --arch amd64 \
            --icon cmd/icon.png \
            --app-id com.report.tracker \  # <--- –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–õ–ê–ì
            --name ReportTracker \
            --output ReportTracker \
            ./cmd  # <--- –ü–∞–∫–µ—Ç –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
      - name: Prepare Artifact
        run: |
          mv fyne-cross/bin/windows-amd64/ReportTracker.exe ReportTracker_Windows_x64.exe
      - name: Upload Release Asset
        uses: softprops/action-gh-release@v1
        with:
          files: ReportTracker_Windows_x64.exe

  # ------------------------------------------------------------------
  # JOB 2: –°–±–æ—Ä–∫–∞ –¥–ª—è macOS ( fyne package )
  # ------------------------------------------------------------------
  build_macos:
    name: üçé Build macOS (Intel & M1)
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - name: Install Fyne CLI
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ PATH
        run: go install fyne.io/fyne/v2/cmd/fyne@latest

      # --- –°–±–æ—Ä–∫–∞ –¥–ª—è Intel (amd64) ---
      - name: üì¶ Package macOS Intel (amd64)
        run: |
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=amd64
          
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É fyne –∏ –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–æ–≤
          $HOME/go/bin/fyne package --os darwin \
            --sourceDir cmd \ # <--- –§–õ–ê–ì –î–õ–Ø –ü–ê–ü–ö–ò –° –ö–û–î–û–ú
            --icon cmd/icon.png \ # <--- –§–õ–ê–ì –î–õ–Ø –ò–ö–û–ù–ö–ò –û–¢–ù–û–°–ò–¢–ï–õ–¨–ù–û –ö–û–†–ù–Ø
            --appID com.report.tracker \
            --name ReportTracker
            
          mv ReportTracker.app ReportTracker_Intel.app
          tar -czf ReportTracker_macOS_Intel.tar.gz ReportTracker_Intel.app

      # --- –°–±–æ—Ä–∫–∞ –¥–ª—è Apple Silicon (arm64/M1) ---
      - name: üì¶ Package macOS Apple Silicon (arm64)
        run: |
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=arm64
          
          $HOME/go/bin/fyne package --os darwin \
            --sourceDir cmd \ # <--- –§–õ–ê–ì –î–õ–Ø –ü–ê–ü–ö–ò –° –ö–û–î–û–ú
            --icon cmd/icon.png \ # <--- –§–õ–ê–ì –î–õ–Ø –ò–ö–û–ù–ö–ò –û–¢–ù–û–°–ò–¢–ï–õ–¨–ù–û –ö–û–†–ù–Ø
            --appID com.report.tracker \
            --name ReportTracker
            
          mv ReportTracker.app ReportTracker_M1.app
          tar -czf ReportTracker_macOS_M1.tar.gz ReportTracker_M1.app

      - name: Upload Release Assets
        uses: softprops/action-gh-release@v1
        with:
          files: |
            ReportTracker_macOS_Intel.tar.gz
            ReportTracker_macOS_M1.tar.gz